{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the CareerPilot AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "authProvider": {
          "type": "string",
          "description": "The authentication provider used by the user (e.g., Google, GitHub)."
        },
        "lastLogin": {
          "type": "string",
          "description": "Timestamp of the user's last login.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "authProvider",
        "lastLogin"
      ]
    },
    "Resume": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Resume",
      "type": "object",
      "description": "Represents a user's resume.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Resume entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Resume)"
        },
        "uploadDate": {
          "type": "string",
          "description": "The timestamp when the resume was uploaded.",
          "format": "date-time"
        },
        "fileUrl": {
          "type": "string",
          "description": "The URL where the resume file is stored.",
          "format": "uri"
        },
        "text": {
          "type": "string",
          "description": "Extracted text content from the resume."
        }
      },
      "required": [
        "id",
        "userId",
        "uploadDate",
        "fileUrl",
        "text"
      ]
    },
    "ResumeAnalysis": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ResumeAnalysis",
      "type": "object",
      "description": "Stores the analysis results for a resume.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ResumeAnalysis entity."
        },
        "resumeId": {
          "type": "string",
          "description": "Reference to Resume. (Relationship: Resume 1:N ResumeAnalysis)"
        },
        "atsScore": {
          "type": "number",
          "description": "The ATS score generated for the resume (0-100)."
        },
        "improvementSuggestions": {
          "type": "string",
          "description": "AI-generated suggestions for improving the resume."
        },
        "analysisDate": {
          "type": "string",
          "description": "Timestamp of when the analysis was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "resumeId",
        "atsScore",
        "improvementSuggestions",
        "analysisDate"
      ]
    },
    "InterviewSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InterviewSession",
      "type": "object",
      "description": "Represents a mock interview session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the InterviewSession entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N InterviewSession)"
        },
        "jobRole": {
          "type": "string",
          "description": "The job role selected for the interview."
        },
        "sessionDate": {
          "type": "string",
          "description": "Timestamp of when the interview session was started.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "jobRole",
        "sessionDate"
      ]
    },
    "InterviewAnswer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InterviewAnswer",
      "type": "object",
      "description": "Represents a user's answer to an interview question within a session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the InterviewAnswer entity."
        },
        "sessionId": {
          "type": "string",
          "description": "Reference to InterviewSession. (Relationship: InterviewSession 1:N InterviewAnswer)"
        },
        "question": {
          "type": "string",
          "description": "The interview question asked."
        },
        "answer": {
          "type": "string",
          "description": "The user's answer to the question."
        },
        "correctnessScore": {
          "type": "number",
          "description": "AI-evaluated correctness score for the answer."
        },
        "clarityScore": {
          "type": "number",
          "description": "AI-evaluated clarity score for the answer."
        },
        "confidenceScore": {
          "type": "number",
          "description": "AI-evaluated confidence score for the answer."
        },
        "modelAnswer": {
          "type": "string",
          "description": "AI-generated model answer for the question."
        },
        "improvementSuggestions": {
          "type": "string",
          "description": "AI-generated suggestions for improving the answer."
        }
      },
      "required": [
        "id",
        "sessionId",
        "question",
        "answer",
        "correctnessScore",
        "clarityScore",
        "confidenceScore",
        "modelAnswer",
        "improvementSuggestions"
      ]
    },
    "SkillGapAnalysis": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SkillGapAnalysis",
      "type": "object",
      "description": "Stores the results of a skill-gap analysis.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the SkillGapAnalysis entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N SkillGapAnalysis)"
        },
        "jobRole": {
          "type": "string",
          "description": "The job role used for the skill-gap analysis."
        },
        "missingSkills": {
          "type": "string",
          "description": "Comma-separated list of missing skills identified."
        },
        "learningRoadmap": {
          "type": "string",
          "description": "Personalized learning roadmap generated for the user."
        },
        "analysisDate": {
          "type": "string",
          "description": "Timestamp of when the skill-gap analysis was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "jobRole",
        "missingSkills",
        "learningRoadmap",
        "analysisDate"
      ]
    },
    "JobDescriptionAnalysis": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "JobDescriptionAnalysis",
      "type": "object",
      "description": "Stores the analysis results for a job description.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the JobDescriptionAnalysis entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N JobDescriptionAnalysis)"
        },
        "jobDescriptionText": {
          "type": "string",
          "description": "The full text of the job description."
        },
        "requiredSkills": {
          "type": "string",
          "description": "Comma-separated list of required skills extracted from the job description."
        },
        "experienceLevel": {
          "type": "string",
          "description": "The experience level required for the job."
        },
        "missingKeywords": {
          "type": "string",
          "description": "Comma-separated list of missing keywords from the user's resume compared to the job description."
        },
        "matchPercentage": {
          "type": "number",
          "description": "The percentage match between the user's resume and the job description."
        },
        "analysisDate": {
          "type": "string",
          "description": "Timestamp of when the job description analysis was performed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "jobDescriptionText",
        "requiredSkills",
        "experienceLevel",
        "missingKeywords",
        "matchPercentage",
        "analysisDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com",
      "github.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Authorization is based on the `userId` parameter matching the `request.auth.uid`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/resumes/{resumeId}",
        "definition": {
          "entityName": "Resume",
          "schema": {
            "$ref": "#/backend/entities/Resume"
          },
          "description": "Stores user resumes. Includes denormalized 'userId' field for authorization independence. Authorization is based on the `userId` parameter matching the `request.auth.uid`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "resumeId",
              "description": "The unique identifier for the resume."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/resumes/{resumeId}/analyses/{analysisId}",
        "definition": {
          "entityName": "ResumeAnalysis",
          "schema": {
            "$ref": "#/backend/entities/ResumeAnalysis"
          },
          "description": "Stores resume analysis results. Includes denormalized 'userId' field (from parent Resume) for authorization independence. Authorization is based on the `userId` parameter matching the `request.auth.uid`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "resumeId",
              "description": "The unique identifier for the resume."
            },
            {
              "name": "analysisId",
              "description": "The unique identifier for the analysis."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/interview_sessions/{sessionId}",
        "definition": {
          "entityName": "InterviewSession",
          "schema": {
            "$ref": "#/backend/entities/InterviewSession"
          },
          "description": "Stores interview session information. Includes denormalized 'userId' field for authorization independence. Authorization is based on the `userId` parameter matching the `request.auth.uid`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "sessionId",
              "description": "The unique identifier for the interview session."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/interview_sessions/{sessionId}/answers/{answerId}",
        "definition": {
          "entityName": "InterviewAnswer",
          "schema": {
            "$ref": "#/backend/entities/InterviewAnswer"
          },
          "description": "Stores interview answers for a session. Includes denormalized 'userId' field (from parent InterviewSession) for authorization independence. Authorization is based on the `userId` parameter matching the `request.auth.uid`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "sessionId",
              "description": "The unique identifier for the interview session."
            },
            {
              "name": "answerId",
              "description": "The unique identifier for the interview answer."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/skill_gap_analyses/{analysisId}",
        "definition": {
          "entityName": "SkillGapAnalysis",
          "schema": {
            "$ref": "#/backend/entities/SkillGapAnalysis"
          },
          "description": "Stores skill-gap analysis results. Includes denormalized 'userId' field for authorization independence. Authorization is based on the `userId` parameter matching the `request.auth.uid`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "analysisId",
              "description": "The unique identifier for the skill gap analysis."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/job_description_analyses/{analysisId}",
        "definition": {
          "entityName": "JobDescriptionAnalysis",
          "schema": {
            "$ref": "#/backend/entities/JobDescriptionAnalysis"
          },
          "description": "Stores job description analysis results. Includes denormalized 'userId' field for authorization independence. Authorization is based on the `userId` parameter matching the `request.auth.uid`.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "analysisId",
              "description": "The unique identifier for the job description analysis."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, while adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). It leverages structural segregation and consistent access modeling to achieve these goals.\n\n1.  **Authorization Independence:**\n\n    *   Denormalization is extensively used to avoid hierarchical authorization dependencies (`get()` calls in security rules). For example, access to `Resume` documents is controlled by the `userId` field within the document itself, rather than requiring a lookup to the parent `User` document. Similarly, collections nested under a user document (e.g. resume, skill gap analysis) include the `userId` inside the document to ensure authorization rules can validate the user's `uid` against the `userId` stored in the document. This pattern extends to subcollections as well.\n\n2.  **Structural Segregation:**\n\n    *   Data with different access needs are stored in separate collections. All user-owned data is nested under `/users/{userId}`, ensuring consistent ownership-based security rules.\n\n3.  **Access Modeling:**\n\n    *   **Private Data:** Path-based ownership is used for user-specific data (`/users/{userId}/resumes/{resumeId}`).\n    *   **Hierarchical Paths:** User-owned data is structured using hierarchical paths (e.g., `/users/{userId}/resumes/{resumeId}`), which makes ownership-based security rules straightforward and efficient.\n    *   **Global Roles (DBAC):** Roles are managed through the existence of documents in dedicated collections (e.g., `/roles_admin/{uid}`), avoiding custom claims.\n\n4.  **QAPs (Rules are not Filters):**\n\n    *   The structure enables secure `list` operations because authorization rules can be applied directly to the documents in a collection without needing to filter based on document data after retrieval. Segregation into user-owned subcollections (`/users/{userId}/...`) ensures that listing is always scoped to the authorized user.\n\n5. **Error mitigation:**\n\n   * The error `FirebaseError: Firebase: Error (auth/operation-not-allowed)` arises from attempting an operation that the current authentication state doesn't allow. With anonymous authentication, certain operations are restricted. To resolve this error, the application logic needs to ensure only permitted operations are triggered while in anonymous mode. This may involve conditionally disabling or hiding features that require a full user account. The data structure design facilitates these constraints by strictly delineating user-owned versus potentially public or shared data.\n\n\n"
  }
}

    